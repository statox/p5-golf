var rt=Object.defineProperty;var ct=(n,t,e)=>t in n?rt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var W=(n,t,e)=>(ct(n,typeof t!="symbol"?t+"":t,e),e);import{V as G}from"./p5utils.fe4d08ff.js";import{s as it,f,a as x,e as et,g as h,u as O,c as T,j as _,i as P,z as J,d as y,h as B,y as d,P as R,L as q,Q as F,O as lt,l as K,m as X,n as nt}from"./scheduler.e421d989.js";import{S as st,i as at}from"./index.52486247.js";const dt=(n,t)=>{if(t.geometry.type!=="sphere"||n.geometry.type!=="line")throw new Error("invalid geometry");const e=ut(n,t);if(!e)return;const l=.8,s=.2,o=n.position.x,i=n.position.y,c=n.position.x+n.geometry.vector.x,a=n.position.y+n.geometry.vector.y,S=c-o,u=a-i,g=new G(-u,S),w=new G(u,-S),v=e.clone().add(g),C=e.clone().add(w);let b;t.position.distanceSq(v)<t.position.distanceSq(C)?b=g:b=w;const A=b.clone().normalize(),m=t.velocity.clone(),N=A.multiplyScalar(m.dot(A)),I=m.subtract(N),V=l,D=s;return{bouncedVelocity:I.multiplyScalar(1-D).subtract(N.multiplyScalar(V)),intersection:e}},ut=(n,t)=>{if(t.geometry.type!=="sphere"||n.geometry.type!=="line")throw new Error("invalid geometry");const e=n.position.clone(),l=n.position.clone().add(n.geometry.vector),s=t.position.clone(),o=t.geometry.r,i=l.clone().subtract(e),c=e.clone().subtract(s),a=i.dot(i),S=c.dot(i)*2,u=c.dot(c)-o*o;let g=S*S-4*a*u;if(g<0)return;g=Math.sqrt(g);const w=(-S-g)/(2*a),v=(-S+g)/(2*a),C=w>=0&&w<=1,b=v>=0&&v<=1;if(C&&b)return e.add(i.multiplyScalar(w+(v-w)*.5));if(C)return e.add(i.multiplyScalar(1));if(b)return e.add(i.multiplyScalar(0))};class bt{constructor(t){W(this,"gravityEnabled");W(this,"dimensions");W(this,"t");W(this,"objects");W(this,"gravity",new G(0,-9.8));W(this,"antiGravity",new G(0,9.8));W(this,"drag",.001);W(this,"dt",.005);W(this,"reporter");this.gravityEnabled=t.enableGravity??!0,this.dimensions=t.dimensions||new G(100,100),this.objects=[],this.t=0,this.reporter=t.reporter||console.log}toggleGravity(){this.gravityEnabled=!this.gravityEnabled}addObject(t){this.objects.push(t)}applyGravity(t){t.acceleration.push(this.gravity)}applyForce(t,e){t.acceleration.push(e)}applyDynamics(t,e){this.gravityEnabled&&this.applyGravity(e);const l=new G(0,0);for(;e.acceleration.length;){const o=e.acceleration.pop();o&&l.add(o)}l.divideScalar(e.m);const s=1-this.drag;e.velocity.add(l.multiplyScalar(t)).multiplyScalar(s),e.position.add(e.velocity.clone().multiplyScalar(t))}applyCollisions(t){const e=this.objects.find(i=>i.geometry.type==="sphere"),l=this.objects.filter(i=>i.geometry.type==="line");if(!e)throw new Error("No sphere in world");e.data.isColliding=!1;const s=new G(0,0);let o=0;for(const i of l){i.data.isColliding=!1;const c=dt(i,e);if(!c)continue;const{bouncedVelocity:a,intersection:S}=c;i.data.isColliding=!0,o++,s.add(a);const u=e.position.clone().subtract(S),g=u.length();if(g<=e.geometry.r){const v=e.geometry.r-g;u.normalize().multiplyScalar(v),e.position.add(u)}}o>0&&(s.divideScalar(o),e.velocity.copy(s),e.position.add(e.velocity.clone().multiplyScalar(t)),e.data.isColliding=!0,e.acceleration.push(this.antiGravity))}_step(t){this.applyCollisions(t);for(const e of this.objects)e.fixed||this.applyDynamics(t,e)}stepFixedDt(){const e=Date.now()/1e3;M=e-z,z=e,this._step(.01),this.t+=.01,this.reporter&&this.reporter({...this,frameTime:M})}stepAccumulator(){const t=this.dt,e=Date.now()/1e3;z===0&&(z=e),M=e-z,z=e,Z+=M;let l=0;for(;Z>=t&&l<5;)l++,this._step(t),Z-=t,this.t+=t,this.reporter&&this.reporter({...this,frameTime:M})}step(){this.stepAccumulator()}}let z=0,M=0,Z=0;const St=n=>{var t,e;return{geometry:n.geometry,m:n.mass??1,position:((t=n.position)==null?void 0:t.clone())??new G(0,0),velocity:((e=n.velocity)==null?void 0:e.clone())??new G(0,0),acceleration:[],fixed:n.fixed??!1,data:{isColliding:!1}}};function ot(n){let t,e,l,s,o="dt",i,c,a,S,u,g,w="drag",v,C,b,A,m,N,I="gravity enabled",V,D,k,j,H;return{c(){t=f("table"),e=f("tbody"),l=f("tr"),s=f("th"),s.textContent=o,i=x(),c=f("td"),a=f("input"),S=x(),u=f("tr"),g=f("th"),g.textContent=w,v=x(),C=f("td"),b=f("input"),A=x(),m=f("tr"),N=f("th"),N.textContent=I,V=x(),D=f("td"),k=f("input"),this.h()},l(E){t=h(E,"TABLE",{});var L=B(t);e=h(L,"TBODY",{});var r=B(e);l=h(r,"TR",{});var p=B(l);s=h(p,"TH",{"data-svelte-h":!0}),O(s)!=="svelte-16dheti"&&(s.textContent=o),i=T(p),c=h(p,"TD",{});var U=B(c);a=h(U,"INPUT",{type:!0,min:!0,max:!0,step:!0}),U.forEach(y),p.forEach(y),S=T(r),u=h(r,"TR",{});var Q=B(u);g=h(Q,"TH",{"data-svelte-h":!0}),O(g)!=="svelte-2hq5g"&&(g.textContent=w),v=T(Q),C=h(Q,"TD",{});var $=B(C);b=h($,"INPUT",{type:!0,min:!0,max:!0,step:!0}),$.forEach(y),Q.forEach(y),A=T(r),m=h(r,"TR",{});var Y=B(m);N=h(Y,"TH",{"data-svelte-h":!0}),O(N)!=="svelte-ic0r87"&&(N.textContent=I),V=T(Y),D=h(Y,"TD",{});var tt=B(D);k=h(tt,"INPUT",{type:!0}),tt.forEach(y),Y.forEach(y),r.forEach(y),L.forEach(y),this.h()},h(){_(a,"type","number"),_(a,"min","0"),_(a,"max","0.5"),_(a,"step","0.001"),_(b,"type","number"),_(b,"min","0"),_(b,"max","0.01"),_(b,"step","0.001"),_(k,"type","checkbox")},m(E,L){P(E,t,L),d(t,e),d(e,l),d(l,s),d(l,i),d(l,c),d(c,a),R(a,n[0].dt),d(e,S),d(e,u),d(u,g),d(u,v),d(u,C),d(C,b),R(b,n[0].drag),d(e,A),d(e,m),d(m,N),d(m,V),d(m,D),d(D,k),k.checked=n[0].gravityEnabled,j||(H=[q(a,"input",n[1]),q(b,"input",n[2]),q(k,"change",n[3])],j=!0)},p(E,L){L&1&&F(a.value)!==E[0].dt&&R(a,E[0].dt),L&1&&F(b.value)!==E[0].drag&&R(b,E[0].drag),L&1&&(k.checked=E[0].gravityEnabled)},d(E){E&&y(t),j=!1,lt(H)}}}function pt(n){let t,e="Engine settings",l,s,o=n[0]&&ot(n);return{c(){t=f("p"),t.textContent=e,l=x(),o&&o.c(),s=et(),this.h()},l(i){t=h(i,"P",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-gf3gek"&&(t.textContent=e),l=T(i),o&&o.l(i),s=et(),this.h()},h(){_(t,"class","title svelte-g74uk9")},m(i,c){P(i,t,c),P(i,l,c),o&&o.m(i,c),P(i,s,c)},p(i,[c]){i[0]?o?o.p(i,c):(o=ot(i),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},i:J,o:J,d(i){i&&(y(t),y(l),y(s)),o&&o.d(i)}}}function ft(n,t,e){let{world:l}=t;function s(){l.dt=F(this.value),e(0,l)}function o(){l.drag=F(this.value),e(0,l)}function i(){l.gravityEnabled=this.checked,e(0,l)}return n.$$set=c=>{"world"in c&&e(0,l=c.world)},[l,s,o,i]}class Ct extends st{constructor(t){super(),at(this,t,ft,pt,it,{world:0})}}function ht(n){let t,e="Shooter",l,s,o,i="Angle",c,a,S,u,g,w,v,C,b="Magnitude",A,m,N,I,V,D,k,j,H="Shoot",E,L;return{c(){t=f("p"),t.textContent=e,l=x(),s=f("span"),o=f("label"),o.textContent=i,c=x(),a=f("input"),S=x(),u=K(n[0]),g=K(" deg"),w=x(),v=f("span"),C=f("label"),C.textContent=b,A=x(),m=f("input"),N=x(),I=K(n[1]),V=x(),D=f("br"),k=x(),j=f("button"),j.textContent=H,this.h()},l(r){t=h(r,"P",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-198ugk3"&&(t.textContent=e),l=T(r),s=h(r,"SPAN",{});var p=B(s);o=h(p,"LABEL",{for:!0,"data-svelte-h":!0}),O(o)!=="svelte-lab87n"&&(o.textContent=i),c=T(p),a=h(p,"INPUT",{id:!0,type:!0,min:!0,max:!0}),S=T(p),u=X(p,n[0]),g=X(p," deg"),p.forEach(y),w=T(r),v=h(r,"SPAN",{});var U=B(v);C=h(U,"LABEL",{for:!0,"data-svelte-h":!0}),O(C)!=="svelte-1vc5oxa"&&(C.textContent=b),A=T(U),m=h(U,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),N=T(U),I=X(U,n[1]),U.forEach(y),V=T(r),D=h(r,"BR",{}),k=T(r),j=h(r,"BUTTON",{"data-svelte-h":!0}),O(j)!=="svelte-8jpwxr"&&(j.textContent=H),this.h()},h(){_(t,"class","title svelte-g74uk9"),_(o,"for","angleSlider"),_(a,"id","angleSlider"),_(a,"type","range"),_(a,"min","0"),_(a,"max","360"),_(C,"for","magSlider"),_(m,"id","magSlider"),_(m,"type","range"),_(m,"min","0"),_(m,"max","1"),_(m,"step","0.01")},m(r,p){P(r,t,p),P(r,l,p),P(r,s,p),d(s,o),d(s,c),d(s,a),R(a,n[0]),d(s,S),d(s,u),d(s,g),P(r,w,p),P(r,v,p),d(v,C),d(v,A),d(v,m),R(m,n[1]),d(v,N),d(v,I),P(r,V,p),P(r,D,p),P(r,k,p),P(r,j,p),E||(L=[q(a,"change",n[4]),q(a,"input",n[4]),q(m,"change",n[5]),q(m,"input",n[5]),q(j,"click",n[6])],E=!0)},p(r,[p]){p&1&&R(a,r[0]),p&1&&nt(u,r[0]),p&2&&R(m,r[1]),p&2&&nt(I,r[1])},i:J,o:J,d(r){r&&(y(t),y(l),y(s),y(w),y(v),y(V),y(D),y(k),y(j)),E=!1,lt(L)}}}function mt(n,t,e){let{onShoot:l}=t,s=0,o=.5;const i=()=>{const u=new G(1,0);u.rotateDeg(s),u.multiplyScalar(o),l(u)};function c(){s=F(this.value),e(0,s)}function a(){o=F(this.value),e(1,o)}const S=()=>i();return n.$$set=u=>{"onShoot"in u&&e(3,l=u.onShoot)},[s,o,i,l,c,a,S]}class wt extends st{constructor(t){super(),at(this,t,mt,ht,it,{onShoot:3})}}export{Ct as E,wt as S,bt as W,St as c};
