var K=Object.defineProperty;var Q=(l,t,n)=>t in l?K(l,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[t]=n;var j=(l,t,n)=>(Q(l,typeof t!="symbol"?t+"":t,n),n);import{S as G,i as B,s as L,k as C,w as h,a as k,q as O,l as S,m as D,x as b,h as d,c as E,r as P,n as U,b as y,y as v,D as N,I as V,u as z,f as _,t as w,z as x,J as A}from"../../../chunks/index-33d6e1ba.js";import{v as g,P as J,T as R,a as X,b as q,c as I}from"../../../chunks/index-c8ea7b20.js";const Y=(l,t)=>{if(t.geometry.type!=="sphere"||l.geometry.type!=="line")throw new Error("invalid geometry");const n=l.position.clone(),e=l.geometry.vector.clone(),a=t.position.clone(),s=t.geometry.r,m=e.clone().subtract(n),i=n.clone().subtract(a),f=m.dot(m),o=i.dot(m)*2,$=i.dot(i)-s*s;let c=o*o-4*f*$;if(c<0)return;c=Math.sqrt(c);const p=(-o-c)/(2*f),r=(-o+c)/(2*f);if(p>=0&&p<=1)return n.add(m.multiplyScalar(p));if(r>=0&&r<=1)return n.add(m.multiplyScalar(r))};class H{constructor(t){j(this,"gravityEnabled");j(this,"dimensions");j(this,"t");j(this,"objects");j(this,"gravity",new g(0,-9.8));j(this,"drag",.01);j(this,"reporter");j(this,"lastTick");this.gravityEnabled=t.enableGravity??!0,this.dimensions=t.dimensions||new g(100,100),this.objects=[],this.t=0,this.reporter=t.reporter||console.log,this.lastTick=0}addObject(t){this.objects.push(t)}applyGravity(t){t.acceleration.push(this.gravity)}applyDynamics(t){const n=Date.now(),e=5,a=(n-this.lastTick)/(1e3/60*e);this.gravityEnabled&&this.applyGravity(t);const s=new g(0,0);for(;t.acceleration.length;){const i=t.acceleration.pop();i&&s.add(i)}s.divideScalar(t.m);const m=1-this.drag;t.velocity.add(s.multiplyScalar(a)).multiplyScalar(m),t.position.add(t.velocity.clone().multiplyScalar(a))}applyCollisions(t){const n=this.objects[0],e=this.objects[1],a=Y(n,e);a?(console.log(a),e.data.isColliding=!0):e.data.isColliding=!1;const s=.9;t.position.x<0&&t.velocity.x<0&&(t.velocity.x*=-s),t.position.x>this.dimensions.x&&t.velocity.x>0&&(t.velocity.x*=-s),t.position.y<0&&t.velocity.y<0&&(t.velocity.y*=-s),t.position.y>this.dimensions.y&&t.velocity.y>0&&(t.velocity.y*=-s)}step(){this.t===0&&(this.lastTick=Date.now()),this.t++;for(const t of this.objects)t.fixed||(this.applyDynamics(t),this.applyCollisions(t));this.reporter&&this.reporter(this),this.lastTick=Date.now()}}const F=l=>{var t,n;return{geometry:l.geometry,m:l.mass??10,position:((t=l.position)==null?void 0:t.clone())??new g(0,0),velocity:((n=l.velocity)==null?void 0:n.clone())??new g(0,0),acceleration:[],fixed:l.fixed??!1,data:{isColliding:!1}}};function Z(l){let t,n,e,a,s=l[0][l[0].length-1]+"",m,i,f,o,$,c,p;return n=new J({props:{sketch:l[2]}}),{c(){t=C("div"),h(n.$$.fragment),e=k(),a=C("p"),m=O(s),i=k(),f=C("button"),o=O("New ball"),this.h()},l(r){t=S(r,"DIV",{class:!0});var u=D(t);b(n.$$.fragment,u),u.forEach(d),e=E(r),a=S(r,"P",{});var T=D(a);m=P(T,s),T.forEach(d),i=E(r),f=S(r,"BUTTON",{});var W=D(f);o=P(W,"New ball"),W.forEach(d),this.h()},h(){U(t,"class","d-flex justify-content-center")},m(r,u){y(r,t,u),v(n,t,null),y(r,e,u),y(r,a,u),N(a,m),y(r,i,u),y(r,f,u),N(f,o),$=!0,c||(p=V(f,"click",l[1]),c=!0)},p(r,[u]){(!$||u&1)&&s!==(s=r[0][r[0].length-1]+"")&&z(m,s)},i(r){$||(_(n.$$.fragment,r),$=!0)},o(r){w(n.$$.fragment,r),$=!1},d(r){r&&d(t),x(n),r&&d(e),r&&d(a),r&&d(i),r&&d(f),c=!1,p()}}}function tt(l,t,n){console.clear();let e=[];const a=o=>{const $=o.objects[o.objects.length-1],c=$.position.clone().toFixed(2),p=$.velocity.clone().toFixed(2);e.push(`${o.t} - pos: ${c} - vel: ${p}`),e.length>50&&e.shift(),n(0,e)},s=new H({reporter:a,enableGravity:!0}),m=()=>{for(;s.objects.length;)s.objects.pop();const o=F({geometry:{type:"line",vector:new g(100,0)},position:new g(0,0),fixed:!0});s.addObject(o);for(let $=0;$<1;$++){const c=F({geometry:{type:"sphere",r:5},position:new g(20,50),velocity:new g(Math.random()*5-2.5,Math.random()*20)});s.addObject(c)}};let i;const f=o=>{o.setup=()=>{i=o,o.createCanvas(900,600),o.background(0),o.fill(255),o.stroke(255),m()},o.draw=()=>{o.background(0),s.step();for(const $ of s.objects){const c=o.map($.position.x,0,s.dimensions.x,0,o.width),p=o.map($.position.y,0,s.dimensions.y,o.height,0);if($.geometry.type==="sphere"&&(o.strokeWeight($.geometry.r*2),o.point(c,p)),$.geometry.type==="line"){const r=c+o.map($.geometry.vector.x,0,s.dimensions.x,0,o.width),u=p+o.map($.geometry.vector.y,0,s.dimensions.y,0,o.height);o.strokeWeight(2),o.line(c,p,r,u)}}}};return A(()=>{i==null||i.remove()}),[e,m,f]}class et extends G{constructor(t){super(),B(this,t,tt,Z,L,{})}}function st(l){let t,n,e,a,s=l[0][l[0].length-1]+"",m,i,f,o,$,c,p;return n=new J({props:{sketch:l[2]}}),{c(){t=C("div"),h(n.$$.fragment),e=k(),a=C("p"),m=O(s),i=k(),f=C("button"),o=O("New ball"),this.h()},l(r){t=S(r,"DIV",{class:!0});var u=D(t);b(n.$$.fragment,u),u.forEach(d),e=E(r),a=S(r,"P",{});var T=D(a);m=P(T,s),T.forEach(d),i=E(r),f=S(r,"BUTTON",{});var W=D(f);o=P(W,"New ball"),W.forEach(d),this.h()},h(){U(t,"class","d-flex justify-content-center")},m(r,u){y(r,t,u),v(n,t,null),y(r,e,u),y(r,a,u),N(a,m),y(r,i,u),y(r,f,u),N(f,o),$=!0,c||(p=V(f,"click",l[1]),c=!0)},p(r,[u]){(!$||u&1)&&s!==(s=r[0][r[0].length-1]+"")&&z(m,s)},i(r){$||(_(n.$$.fragment,r),$=!0)},o(r){w(n.$$.fragment,r),$=!1},d(r){r&&d(t),x(n),r&&d(e),r&&d(a),r&&d(i),r&&d(f),c=!1,p()}}}const M=6;function nt(l,t,n){console.clear();let e=[];const a=o=>{const $=o.objects[o.objects.length-1],c=$.position.clone().toFixed(2),p=$.velocity.clone().toFixed(2);e.push(`${o.t} - pos: ${c} - vel: ${p}`),e.length>50&&e.shift(),n(0,e)},s=new H({reporter:a,enableGravity:!0}),m=()=>{for(;s.objects.length;)s.objects.pop();const o=F({geometry:{type:"line",vector:new g(100,0)},position:new g(0,10),fixed:!0});s.addObject(o);for(let $=0;$<1;$++){const c=F({geometry:{type:"sphere",r:5},position:new g(20,50),velocity:new g(2.5,2.5)});s.addObject(c)}};let i;const f=o=>{const $=c=>typeof c=="number"?c*M:c.clone().multiplyScalar(M);o.setup=()=>{i=o;const c=$(s.dimensions);o.createCanvas(c.x,c.y),o.background(0),o.fill(255),o.stroke(255),m()},o.draw=()=>{o.background(0),s.step();for(const c of s.objects){const p=o.map(c.position.x,0,s.dimensions.x,0,o.width),r=o.map(c.position.y,0,s.dimensions.y,o.height,0);if(c.geometry.type==="sphere"){const u=$(c.geometry.r*2);o.strokeWeight(u),o.point(p,r)}if(c.geometry.type==="line"){const u=p+o.map(c.geometry.vector.x,0,s.dimensions.x,0,o.width),T=r+o.map(c.geometry.vector.y,0,s.dimensions.y,0,o.height);o.strokeWeight(2),o.line(p,r,u,T)}}}};return A(()=>{i==null||i.remove()}),[e,m,f]}class ot extends G{constructor(t){super(),B(this,t,nt,st,L,{})}}function it(l){let t;return{c(){t=O("Test engine")},l(n){t=P(n,"Test engine")},m(n,e){y(n,t,e)},d(n){n&&d(t)}}}function rt(l){let t;return{c(){t=O("Test collisions")},l(n){t=P(n,"Test collisions")},m(n,e){y(n,t,e)},d(n){n&&d(t)}}}function lt(l){let t,n,e,a;return t=new I({props:{$$slots:{default:[it]},$$scope:{ctx:l}}}),e=new I({props:{$$slots:{default:[rt]},$$scope:{ctx:l}}}),{c(){h(t.$$.fragment),n=k(),h(e.$$.fragment)},l(s){b(t.$$.fragment,s),n=E(s),b(e.$$.fragment,s)},m(s,m){v(t,s,m),y(s,n,m),v(e,s,m),a=!0},p(s,m){const i={};m&1&&(i.$$scope={dirty:m,ctx:s}),t.$set(i);const f={};m&1&&(f.$$scope={dirty:m,ctx:s}),e.$set(f)},i(s){a||(_(t.$$.fragment,s),_(e.$$.fragment,s),a=!0)},o(s){w(t.$$.fragment,s),w(e.$$.fragment,s),a=!1},d(s){x(t,s),s&&d(n),x(e,s)}}}function at(l){let t,n;return t=new et({}),{c(){h(t.$$.fragment)},l(e){b(t.$$.fragment,e)},m(e,a){v(t,e,a),n=!0},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){w(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function ct(l){let t,n;return t=new ot({}),{c(){h(t.$$.fragment)},l(e){b(t.$$.fragment,e)},m(e,a){v(t,e,a),n=!0},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){w(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function ft(l){let t,n,e,a,s,m;return t=new X({props:{$$slots:{default:[lt]},$$scope:{ctx:l}}}),e=new q({props:{$$slots:{default:[at]},$$scope:{ctx:l}}}),s=new q({props:{$$slots:{default:[ct]},$$scope:{ctx:l}}}),{c(){h(t.$$.fragment),n=k(),h(e.$$.fragment),a=k(),h(s.$$.fragment)},l(i){b(t.$$.fragment,i),n=E(i),b(e.$$.fragment,i),a=E(i),b(s.$$.fragment,i)},m(i,f){v(t,i,f),y(i,n,f),v(e,i,f),y(i,a,f),v(s,i,f),m=!0},p(i,f){const o={};f&1&&(o.$$scope={dirty:f,ctx:i}),t.$set(o);const $={};f&1&&($.$$scope={dirty:f,ctx:i}),e.$set($);const c={};f&1&&(c.$$scope={dirty:f,ctx:i}),s.$set(c)},i(i){m||(_(t.$$.fragment,i),_(e.$$.fragment,i),_(s.$$.fragment,i),m=!0)},o(i){w(t.$$.fragment,i),w(e.$$.fragment,i),w(s.$$.fragment,i),m=!1},d(i){x(t,i),i&&d(n),x(e,i),i&&d(a),x(s,i)}}}function $t(l){let t,n;return t=new R({props:{$$slots:{default:[ft]},$$scope:{ctx:l}}}),{c(){h(t.$$.fragment)},l(e){b(t.$$.fragment,e)},m(e,a){v(t,e,a),n=!0},p(e,[a]){const s={};a&1&&(s.$$scope={dirty:a,ctx:e}),t.$set(s)},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){w(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}class dt extends G{constructor(t){super(),B(this,t,null,$t,L,{})}}export{dt as default};
