var re=Object.defineProperty;var le=(m,e,n)=>e in m?re(m,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[e]=n;var x=(m,e,n)=>(le(m,typeof e!="symbol"?e+"":e,n),n);import{S as L,i as M,s as X,k as C,w as j,a as D,q as P,l as E,m as O,x as S,h as g,c as W,r as N,n as V,b as $,y as k,D as I,I as te,u as oe,f as b,t as v,z as T,J as A,B as ne,e as F,g as U,d as z,P as se,v as H}from"../../../chunks/index-8cded794.js";import{v as y,P as J,T as ce,a as ae,b as fe,c as me}from"../../../chunks/index-576dfa75.js";const ue=(m,e)=>{if(e.geometry.type!=="sphere"||m.geometry.type!=="line")throw new Error("invalid geometry");const n=m.position.clone(),o=m.position.clone().add(m.geometry.vector),i=e.position.clone(),c=e.geometry.r,s=o.clone().subtract(n),f=n.clone().subtract(i),l=s.dot(s),t=f.dot(s)*2,u=f.dot(f)-c*c;let r=t*t-4*l*u;if(r<0)return;r=Math.sqrt(r);const p=(-t-r)/(2*l),a=(-t+r)/(2*l);if(p>=0&&p<=1)return n.add(s.multiplyScalar(p));if(a>=0&&a<=1)return n.add(s.multiplyScalar(a))};class R{constructor(e){x(this,"gravityEnabled");x(this,"dimensions");x(this,"t");x(this,"objects");x(this,"gravity",new y(0,-9.8));x(this,"drag",.01);x(this,"reporter");x(this,"lastTick");this.gravityEnabled=e.enableGravity??!0,this.dimensions=e.dimensions||new y(100,100),this.objects=[],this.t=0,this.reporter=e.reporter||console.log,this.lastTick=0}addObject(e){this.objects.push(e)}applyGravity(e){e.acceleration.push(this.gravity)}applyDynamics(e){const n=Date.now(),o=5,i=(n-this.lastTick)/(1e3/60*o);this.gravityEnabled&&this.applyGravity(e);const c=new y(0,0);for(;e.acceleration.length;){const f=e.acceleration.pop();f&&c.add(f)}c.divideScalar(e.m);const s=1-this.drag;e.velocity.add(c.multiplyScalar(i)).multiplyScalar(s),e.position.add(e.velocity.clone().multiplyScalar(i))}applyCollisions(e){const n=this.objects.find(c=>c.geometry.type==="sphere"),o=this.objects.filter(c=>c.geometry.type==="line");if(!n)throw new Error("No sphere in world");n.data.isColliding=!1;for(const c of o)ue(c,n)&&(n.data.isColliding=!0);const i=.9;e.position.x<0&&e.velocity.x<0&&(e.velocity.x*=-i),e.position.x>this.dimensions.x&&e.velocity.x>0&&(e.velocity.x*=-i),e.position.y<0&&e.velocity.y<0&&(e.velocity.y*=-i),e.position.y>this.dimensions.y&&e.velocity.y>0&&(e.velocity.y*=-i)}step(){this.t===0&&(this.lastTick=Date.now()),this.t++;for(const e of this.objects)e.fixed||this.applyDynamics(e),this.applyCollisions(e);this.reporter&&this.reporter(this),this.lastTick=Date.now()}}const _=m=>{var e,n;return{geometry:m.geometry,m:m.mass??10,position:((e=m.position)==null?void 0:e.clone())??new y(0,0),velocity:((n=m.velocity)==null?void 0:n.clone())??new y(0,0),acceleration:[],fixed:m.fixed??!1,data:{isColliding:!1}}};function de(m){let e,n,o,i,c=m[0][m[0].length-1]+"",s,f,l,t,u,r,p;return n=new J({props:{sketch:m[2]}}),{c(){e=C("div"),j(n.$$.fragment),o=D(),i=C("p"),s=P(c),f=D(),l=C("button"),t=P("New ball"),this.h()},l(a){e=E(a,"DIV",{class:!0});var d=O(e);S(n.$$.fragment,d),d.forEach(g),o=W(a),i=E(a,"P",{});var h=O(i);s=N(h,c),h.forEach(g),f=W(a),l=E(a,"BUTTON",{});var w=O(l);t=N(w,"New ball"),w.forEach(g),this.h()},h(){V(e,"class","d-flex justify-content-center")},m(a,d){$(a,e,d),k(n,e,null),$(a,o,d),$(a,i,d),I(i,s),$(a,f,d),$(a,l,d),I(l,t),u=!0,r||(p=te(l,"click",m[1]),r=!0)},p(a,[d]){(!u||d&1)&&c!==(c=a[0][a[0].length-1]+"")&&oe(s,c)},i(a){u||(b(n.$$.fragment,a),u=!0)},o(a){v(n.$$.fragment,a),u=!1},d(a){a&&g(e),T(n),a&&g(o),a&&g(i),a&&g(f),a&&g(l),r=!1,p()}}}function he(m,e,n){console.clear();let o=[];const i=t=>{const u=t.objects[t.objects.length-1],r=u.position.clone().toFixed(2),p=u.velocity.clone().toFixed(2);o.push(`${t.t} - pos: ${r} - vel: ${p}`),o.length>50&&o.shift(),n(0,o)},c=new R({reporter:i,enableGravity:!0}),s=()=>{for(;c.objects.length;)c.objects.pop();const t=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,0),fixed:!0});c.addObject(t);for(let u=0;u<1;u++){const r=_({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)});c.addObject(r)}};let f;const l=t=>{t.setup=()=>{f=t,t.createCanvas(900,600),t.background(0),t.fill(255),t.stroke(255),s()},t.draw=()=>{t.background(0),c.step();for(const u of c.objects){const r=t.map(u.position.x,0,c.dimensions.x,0,t.width),p=t.map(u.position.y,0,c.dimensions.y,t.height,0);if(u.geometry.type==="sphere"&&(t.strokeWeight(u.geometry.r*2),t.point(r,p)),u.geometry.type==="line"){const a=r+t.map(u.geometry.vector.x,0,c.dimensions.x,0,t.width),d=p+t.map(u.geometry.vector.y,0,c.dimensions.y,0,t.height);t.strokeWeight(2),t.line(r,p,a,d)}}}};return A(()=>{f==null||f.remove()}),[o,s,l]}class pe extends L{constructor(e){super(),M(this,e,he,de,X,{})}}function ye(m){let e,n,o,i,c=m[0][m[0].length-1]+"",s,f,l,t,u,r,p;return n=new J({props:{sketch:m[2]}}),{c(){e=C("div"),j(n.$$.fragment),o=D(),i=C("p"),s=P(c),f=D(),l=C("button"),t=P("New ball"),this.h()},l(a){e=E(a,"DIV",{class:!0});var d=O(e);S(n.$$.fragment,d),d.forEach(g),o=W(a),i=E(a,"P",{});var h=O(i);s=N(h,c),h.forEach(g),f=W(a),l=E(a,"BUTTON",{});var w=O(l);t=N(w,"New ball"),w.forEach(g),this.h()},h(){V(e,"class","d-flex justify-content-center")},m(a,d){$(a,e,d),k(n,e,null),$(a,o,d),$(a,i,d),I(i,s),$(a,f,d),$(a,l,d),I(l,t),u=!0,r||(p=te(l,"click",m[1]),r=!0)},p(a,[d]){(!u||d&1)&&c!==(c=a[0][a[0].length-1]+"")&&oe(s,c)},i(a){u||(b(n.$$.fragment,a),u=!0)},o(a){v(n.$$.fragment,a),u=!1},d(a){a&&g(e),T(n),a&&g(o),a&&g(i),a&&g(f),a&&g(l),r=!1,p()}}}const B=6;function ge(m,e,n){console.clear();let o=[];const i=r=>{const p=r.objects[r.objects.length-1],a=p.position.clone().toFixed(2),d=p.velocity.clone().toFixed(2);o.push(`${r.t} - pos: ${a} - vel: ${d}`),o.length>50&&o.shift(),n(0,o)},c=new R({reporter:i,enableGravity:!0});let s,f;const l=()=>{for(;c.objects.length;)c.objects.pop();f=_({geometry:{type:"line",vector:new y(80,20)},position:new y(10,20),fixed:!0}),c.addObject(f),s=_({geometry:{type:"sphere",r:10},position:new y(20,50),velocity:new y(2.5,2.5),fixed:!0}),c.addObject(s)};let t;const u=r=>{const p=h=>typeof h=="number"?h*B:h.clone().multiplyScalar(B),a=h=>typeof h=="number"?h/B:h.clone().divideScalar(B);r.setup=()=>{t=r;const h=p(c.dimensions);r.createCanvas(h.x,h.y),r.background(0),r.fill(255),r.stroke(255),l()};let d;r.draw=()=>{if(r.background(0),c.step(),r.mouseIsPressed){const h=a(new y(r.mouseX,r.height-r.mouseY));if(d||(h.distance(s.position)<2?d="sphere":h.distance(f.position)<2?d="wallstart":h.distance(f.geometry.vector.clone().add(f.position))<2&&(d="wallend")),d==="sphere"&&s.position.copy(h),d==="wallstart"&&f.position.copy(h),d==="wallend"){const w=h.clone().subtract(f.position);f.geometry.vector.copy(w)}}else d=void 0;for(const h of c.objects){r.stroke(s.data.isColliding?"red":"white");const w=r.map(h.position.x,0,c.dimensions.x,0,r.width),Y=r.map(h.position.y,0,c.dimensions.y,r.height,0);if(h.geometry.type==="sphere"){const q=p(h.geometry.r*2);r.strokeWeight(q),r.point(w,Y)}if(h.geometry.type==="line"){const q=w+r.map(h.geometry.vector.x,0,c.dimensions.x,0,r.width),ie=Y-r.map(h.geometry.vector.y,0,c.dimensions.y,0,r.height);r.strokeWeight(2),r.line(w,Y,q,ie)}}}};return A(()=>{t==null||t.remove()}),[o,l,u]}class $e extends L{constructor(e){super(),M(this,e,ge,ye,X,{})}}function be(m){let e,n,o;return n=new J({props:{sketch:m[0]}}),{c(){e=C("div"),j(n.$$.fragment),this.h()},l(i){e=E(i,"DIV",{class:!0});var c=O(e);S(n.$$.fragment,c),c.forEach(g),this.h()},h(){V(e,"class","d-flex justify-content-center")},m(i,c){$(i,e,c),k(n,e,null),o=!0},p:ne,i(i){o||(b(n.$$.fragment,i),o=!0)},o(i){v(n.$$.fragment,i),o=!1},d(i){i&&g(e),T(n)}}}const G=6;function ve(m){console.clear();const e=new R({reporter:()=>{},enableGravity:!0});let n;const o=()=>{for(;e.objects.length;)e.objects.pop();const t=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,2),fixed:!0});e.addObject(t);const u=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,98),fixed:!0});e.addObject(u);const r=_({geometry:{type:"line",vector:new y(0,100)},position:new y(2,0),fixed:!0});e.addObject(r);const p=_({geometry:{type:"line",vector:new y(0,100)},position:new y(98,0),fixed:!0});e.addObject(p);const a=_({geometry:{type:"line",vector:new y(50,50)},position:new y(20,10),fixed:!0});e.addObject(a),n=_({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)}),e.addObject(n)},i=t=>typeof t=="number"?t*G:t.clone().multiplyScalar(G),c=t=>typeof t=="number"?t/G:t.clone().divideScalar(G),s=(t,u)=>{for(const r of u.objects){t.stroke(r.data.isColliding?"red":"white");const p=t.map(r.position.x,0,u.dimensions.x,0,t.width),a=t.map(r.position.y,0,u.dimensions.y,t.height,0);if(r.geometry.type==="sphere"){const d=i(r.geometry.r*2);t.strokeWeight(d),t.point(p,a)}if(r.geometry.type==="line"){const d=p+t.map(r.geometry.vector.x,0,u.dimensions.x,0,t.width),h=a-t.map(r.geometry.vector.y,0,u.dimensions.y,0,t.height);t.strokeWeight(2),t.line(p,a,d,h)}}};let f;const l=t=>{t.setup=()=>{f=t;const r=i(e.dimensions);t.createCanvas(r.x,r.y),t.background(0),t.fill(255),t.stroke(255),o()},t.draw=()=>{if(t.background(0),t.mouseIsPressed){n.fixed=!0;const r=c(new y(t.mouseX,t.height-t.mouseY));n.position.copy(r)}else n.fixed=!1;e.step(),s(t,e)};let u;t.mousePressed=()=>{u=c(new y(t.mouseX,t.height-t.mouseY))},t.mouseReleased=()=>{const r=c(new y(t.mouseX,t.height-t.mouseY)),p=u.subtract(r);n.position.copy(r),n.velocity.copy(p)}};return A(()=>{f==null||f.remove()}),[l]}class we extends L{constructor(e){super(),M(this,e,ve,be,X,{})}}function K(m,e,n){const o=m.slice();return o[1]=e[n],o}function Q(m,e,n){const o=m.slice();return o[1]=e[n],o}function _e(m){let e=m[1].title+"",n;return{c(){n=P(e)},l(o){n=N(o,e)},m(o,i){$(o,n,i)},p:ne,d(o){o&&g(n)}}}function Z(m){let e,n;return e=new me({props:{$$slots:{default:[_e]},$$scope:{ctx:m}}}),{c(){j(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,i){k(e,o,i),n=!0},p(o,i){const c={};i&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){T(e,o)}}}function xe(m){let e,n,o=m[0],i=[];for(let s=0;s<o.length;s+=1)i[s]=Z(Q(m,o,s));const c=s=>v(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=F()},l(s){for(let f=0;f<i.length;f+=1)i[f].l(s);e=F()},m(s,f){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(s,f);$(s,e,f),n=!0},p(s,f){if(f&1){o=s[0];let l;for(l=0;l<o.length;l+=1){const t=Q(s,o,l);i[l]?(i[l].p(t,f),b(i[l],1)):(i[l]=Z(t),i[l].c(),b(i[l],1),i[l].m(e.parentNode,e))}for(U(),l=o.length;l<i.length;l+=1)c(l);z()}},i(s){if(!n){for(let f=0;f<o.length;f+=1)b(i[f]);n=!0}},o(s){i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)v(i[f]);n=!1},d(s){se(i,s),s&&g(e)}}}function je(m){let e,n,o;var i=m[1].component;function c(s){return{}}return i&&(e=H(i,c())),{c(){e&&j(e.$$.fragment),n=D()},l(s){e&&S(e.$$.fragment,s),n=W(s)},m(s,f){e&&k(e,s,f),$(s,n,f),o=!0},p(s,f){if(i!==(i=s[1].component)){if(e){U();const l=e;v(l.$$.fragment,1,0,()=>{T(l,1)}),z()}i?(e=H(i,c()),j(e.$$.fragment),b(e.$$.fragment,1),k(e,n.parentNode,n)):e=null}},i(s){o||(e&&b(e.$$.fragment,s),o=!0)},o(s){e&&v(e.$$.fragment,s),o=!1},d(s){e&&T(e,s),s&&g(n)}}}function ee(m){let e,n;return e=new fe({props:{$$slots:{default:[je]},$$scope:{ctx:m}}}),{c(){j(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,i){k(e,o,i),n=!0},p(o,i){const c={};i&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){T(e,o)}}}function ke(m){let e,n,o,i;e=new ae({props:{$$slots:{default:[xe]},$$scope:{ctx:m}}});let c=m[0],s=[];for(let l=0;l<c.length;l+=1)s[l]=ee(K(m,c,l));const f=l=>v(s[l],1,1,()=>{s[l]=null});return{c(){j(e.$$.fragment),n=D();for(let l=0;l<s.length;l+=1)s[l].c();o=F()},l(l){S(e.$$.fragment,l),n=W(l);for(let t=0;t<s.length;t+=1)s[t].l(l);o=F()},m(l,t){k(e,l,t),$(l,n,t);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(l,t);$(l,o,t),i=!0},p(l,t){const u={};if(t&64&&(u.$$scope={dirty:t,ctx:l}),e.$set(u),t&1){c=l[0];let r;for(r=0;r<c.length;r+=1){const p=K(l,c,r);s[r]?(s[r].p(p,t),b(s[r],1)):(s[r]=ee(p),s[r].c(),b(s[r],1),s[r].m(o.parentNode,o))}for(U(),r=c.length;r<s.length;r+=1)f(r);z()}},i(l){if(!i){b(e.$$.fragment,l);for(let t=0;t<c.length;t+=1)b(s[t]);i=!0}},o(l){v(e.$$.fragment,l),s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)v(s[t]);i=!1},d(l){T(e,l),l&&g(n),se(s,l),l&&g(o)}}}function Te(m){let e,n;return e=new ce({props:{$$slots:{default:[ke]},$$scope:{ctx:m}}}),{c(){j(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,i){k(e,o,i),n=!0},p(o,[i]){const c={};i&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){T(e,o)}}}function Se(m){return[[{title:"Test collisions 2",component:we},{title:"Test collisions",component:$e},{title:"Test engine",component:pe}]]}class De extends L{constructor(e){super(),M(this,e,Se,Te,X,{})}}export{De as default};
