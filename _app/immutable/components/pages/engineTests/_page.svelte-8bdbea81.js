var ce=Object.defineProperty;var ae=(a,e,o)=>e in a?ce(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o;var x=(a,e,o)=>(ae(a,typeof e!="symbol"?e+"":e,o),o);import{S as F,i as M,s as X,k as C,w as j,a as P,q as B,l as E,m as O,x as T,h as g,c as D,r as I,n as z,b as $,y as k,D as L,I as oe,u as ne,f as b,t as v,z as S,J as A,B as se,e as q,g as U,d as J,P as ie,v as K}from"../../../chunks/index-8cded794.js";import{v as y,P as R,T as fe,a as me,b as ue,c as de}from"../../../chunks/index-576dfa75.js";const pe=(a,e)=>{if(e.geometry.type!=="sphere"||a.geometry.type!=="line")throw new Error("invalid geometry");const o=he(a,e);if(!o){e.data.isColliding=!1;return}e.data.isColliding=!0;const n=.8,i=.2,c=a.position.x,s=a.position.y,m=a.position.x+a.geometry.vector.x,l=a.position.y+a.geometry.vector.y,t=m-c,u=l-s,r=new y(-u,t),h=new y(u,-t),f=o.clone().add(r),d=o.clone().add(h);let p;e.position.distanceSq(f)<e.position.distanceSq(d)?p=r:p=h;const w=p.clone().normalize(),W=e.velocity.clone(),N=w.multiplyScalar(W.dot(w)),Y=W.subtract(N),re=n,le=i;return Y.multiplyScalar(1-le).subtract(N.multiplyScalar(re))},he=(a,e)=>{if(e.geometry.type!=="sphere"||a.geometry.type!=="line")throw new Error("invalid geometry");const o=a.position.clone(),n=a.position.clone().add(a.geometry.vector),i=e.position.clone(),c=e.geometry.r,s=n.clone().subtract(o),m=o.clone().subtract(i),l=s.dot(s),t=m.dot(s)*2,u=m.dot(m)-c*c;let r=t*t-4*l*u;if(r<0)return;r=Math.sqrt(r);const h=(-t-r)/(2*l),f=(-t+r)/(2*l);if(h>=0&&h<=1)return o.add(s.multiplyScalar(h));if(f>=0&&f<=1)return o.add(s.multiplyScalar(f))};class H{constructor(e){x(this,"gravityEnabled");x(this,"dimensions");x(this,"t");x(this,"objects");x(this,"gravity",new y(0,-9.8));x(this,"drag",.01);x(this,"reporter");x(this,"lastTick");this.gravityEnabled=e.enableGravity??!0,this.dimensions=e.dimensions||new y(100,100),this.objects=[],this.t=0,this.reporter=e.reporter||console.log,this.lastTick=0}addObject(e){this.objects.push(e)}applyGravity(e){e.acceleration.push(this.gravity)}applyDynamics(e,o){this.gravityEnabled&&this.applyGravity(o);const n=new y(0,0);for(;o.acceleration.length;){const c=o.acceleration.pop();c&&n.add(c)}n.divideScalar(o.m);const i=1-this.drag;o.velocity.add(n.multiplyScalar(e)).multiplyScalar(i),o.position.add(o.velocity.clone().multiplyScalar(e))}applyCollisions(e){const o=this.objects.find(s=>s.geometry.type==="sphere"),n=this.objects.filter(s=>s.geometry.type==="line");if(!o)throw new Error("No sphere in world");const i=new y(0,0);let c=0;for(const s of n){const m=pe(s,o);m&&(c++,i.add(m))}c>0&&(i.divideScalar(c),o.velocity.copy(i),o.position.add(o.velocity.clone().multiplyScalar(e)))}step(){this.t===0&&(this.lastTick=Date.now()),this.t++;const e=Date.now(),o=5,n=(e-this.lastTick)/(1e3/60*o);for(const i of this.objects)i.fixed||this.applyDynamics(n,i);this.applyCollisions(n),this.reporter&&this.reporter(this),this.lastTick=Date.now()}}const _=a=>{var e,o;return{geometry:a.geometry,m:a.mass??10,position:((e=a.position)==null?void 0:e.clone())??new y(0,0),velocity:((o=a.velocity)==null?void 0:o.clone())??new y(0,0),acceleration:[],fixed:a.fixed??!1,data:{isColliding:!1}}};function ye(a){let e,o,n,i,c=a[0][a[0].length-1]+"",s,m,l,t,u,r,h;return o=new R({props:{sketch:a[2]}}),{c(){e=C("div"),j(o.$$.fragment),n=P(),i=C("p"),s=B(c),m=P(),l=C("button"),t=B("New ball"),this.h()},l(f){e=E(f,"DIV",{class:!0});var d=O(e);T(o.$$.fragment,d),d.forEach(g),n=D(f),i=E(f,"P",{});var p=O(i);s=I(p,c),p.forEach(g),m=D(f),l=E(f,"BUTTON",{});var w=O(l);t=I(w,"New ball"),w.forEach(g),this.h()},h(){z(e,"class","d-flex justify-content-center")},m(f,d){$(f,e,d),k(o,e,null),$(f,n,d),$(f,i,d),L(i,s),$(f,m,d),$(f,l,d),L(l,t),u=!0,r||(h=oe(l,"click",a[1]),r=!0)},p(f,[d]){(!u||d&1)&&c!==(c=f[0][f[0].length-1]+"")&&ne(s,c)},i(f){u||(b(o.$$.fragment,f),u=!0)},o(f){v(o.$$.fragment,f),u=!1},d(f){f&&g(e),S(o),f&&g(n),f&&g(i),f&&g(m),f&&g(l),r=!1,h()}}}function ge(a,e,o){console.clear();let n=[];const i=t=>{const u=t.objects[t.objects.length-1],r=u.position.clone().toFixed(2),h=u.velocity.clone().toFixed(2);n.push(`${t.t} - pos: ${r} - vel: ${h}`),n.length>50&&n.shift(),o(0,n)},c=new H({reporter:i,enableGravity:!0}),s=()=>{for(;c.objects.length;)c.objects.pop();const t=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,0),fixed:!0});c.addObject(t);for(let u=0;u<1;u++){const r=_({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)});c.addObject(r)}};let m;const l=t=>{t.setup=()=>{m=t,t.createCanvas(900,600),t.background(0),t.fill(255),t.stroke(255),s()},t.draw=()=>{t.background(0),c.step();for(const u of c.objects){const r=t.map(u.position.x,0,c.dimensions.x,0,t.width),h=t.map(u.position.y,0,c.dimensions.y,t.height,0);if(u.geometry.type==="sphere"&&(t.strokeWeight(u.geometry.r*2),t.point(r,h)),u.geometry.type==="line"){const f=r+t.map(u.geometry.vector.x,0,c.dimensions.x,0,t.width),d=h+t.map(u.geometry.vector.y,0,c.dimensions.y,0,t.height);t.strokeWeight(2),t.line(r,h,f,d)}}}};return A(()=>{m==null||m.remove()}),[n,s,l]}class $e extends F{constructor(e){super(),M(this,e,ge,ye,X,{})}}function be(a){let e,o,n,i,c=a[0][a[0].length-1]+"",s,m,l,t,u,r,h;return o=new R({props:{sketch:a[2]}}),{c(){e=C("div"),j(o.$$.fragment),n=P(),i=C("p"),s=B(c),m=P(),l=C("button"),t=B("New ball"),this.h()},l(f){e=E(f,"DIV",{class:!0});var d=O(e);T(o.$$.fragment,d),d.forEach(g),n=D(f),i=E(f,"P",{});var p=O(i);s=I(p,c),p.forEach(g),m=D(f),l=E(f,"BUTTON",{});var w=O(l);t=I(w,"New ball"),w.forEach(g),this.h()},h(){z(e,"class","d-flex justify-content-center")},m(f,d){$(f,e,d),k(o,e,null),$(f,n,d),$(f,i,d),L(i,s),$(f,m,d),$(f,l,d),L(l,t),u=!0,r||(h=oe(l,"click",a[1]),r=!0)},p(f,[d]){(!u||d&1)&&c!==(c=f[0][f[0].length-1]+"")&&ne(s,c)},i(f){u||(b(o.$$.fragment,f),u=!0)},o(f){v(o.$$.fragment,f),u=!1},d(f){f&&g(e),S(o),f&&g(n),f&&g(i),f&&g(m),f&&g(l),r=!1,h()}}}const V=6;function we(a,e,o){console.clear();let n=[];const i=r=>{const h=r.objects[r.objects.length-1],f=h.position.clone().toFixed(2),d=h.velocity.clone().toFixed(2);n.push(`${r.t} - pos: ${f} - vel: ${d}`),n.length>50&&n.shift(),o(0,n)},c=new H({reporter:i,enableGravity:!0});let s,m;const l=()=>{for(;c.objects.length;)c.objects.pop();m=_({geometry:{type:"line",vector:new y(80,20)},position:new y(10,20),fixed:!0}),c.addObject(m),s=_({geometry:{type:"sphere",r:10},position:new y(20,50),velocity:new y(2.5,2.5),fixed:!0}),c.addObject(s)};let t;const u=r=>{const h=p=>typeof p=="number"?p*V:p.clone().multiplyScalar(V),f=p=>typeof p=="number"?p/V:p.clone().divideScalar(V);r.setup=()=>{t=r;const p=h(c.dimensions);r.createCanvas(p.x,p.y),r.background(0),r.fill(255),r.stroke(255),l()};let d;r.draw=()=>{if(r.background(0),c.step(),r.mouseIsPressed){const p=f(new y(r.mouseX,r.height-r.mouseY));if(d||(p.distance(s.position)<2?d="sphere":p.distance(m.position)<2?d="wallstart":p.distance(m.geometry.vector.clone().add(m.position))<2&&(d="wallend")),d==="sphere"&&s.position.copy(p),d==="wallstart"&&m.position.copy(p),d==="wallend"){const w=p.clone().subtract(m.position);m.geometry.vector.copy(w)}}else d=void 0;for(const p of c.objects){r.stroke(s.data.isColliding?"red":"white");const w=r.map(p.position.x,0,c.dimensions.x,0,r.width),W=r.map(p.position.y,0,c.dimensions.y,r.height,0);if(p.geometry.type==="sphere"){const N=h(p.geometry.r*2);r.strokeWeight(N),r.point(w,W)}if(p.geometry.type==="line"){const N=w+r.map(p.geometry.vector.x,0,c.dimensions.x,0,r.width),Y=W-r.map(p.geometry.vector.y,0,c.dimensions.y,0,r.height);r.strokeWeight(2),r.line(w,W,N,Y)}}}};return A(()=>{t==null||t.remove()}),[n,l,u]}class ve extends F{constructor(e){super(),M(this,e,we,be,X,{})}}function _e(a){let e,o,n;return o=new R({props:{sketch:a[0]}}),{c(){e=C("div"),j(o.$$.fragment),this.h()},l(i){e=E(i,"DIV",{class:!0});var c=O(e);T(o.$$.fragment,c),c.forEach(g),this.h()},h(){z(e,"class","d-flex justify-content-center")},m(i,c){$(i,e,c),k(o,e,null),n=!0},p:se,i(i){n||(b(o.$$.fragment,i),n=!0)},o(i){v(o.$$.fragment,i),n=!1},d(i){i&&g(e),S(o)}}}const G=6;function xe(a){console.clear();const e=new H({reporter:()=>{},enableGravity:!0});let o;const n=()=>{for(;e.objects.length;)e.objects.pop();const t=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,2),fixed:!0});e.addObject(t);const u=_({geometry:{type:"line",vector:new y(100,0)},position:new y(0,98),fixed:!0});e.addObject(u);const r=_({geometry:{type:"line",vector:new y(0,100)},position:new y(2,0),fixed:!0});e.addObject(r);const h=_({geometry:{type:"line",vector:new y(0,100)},position:new y(98,0),fixed:!0});e.addObject(h);const f=_({geometry:{type:"line",vector:new y(50,50)},position:new y(20,10),fixed:!0});e.addObject(f),o=_({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)}),e.addObject(o)},i=t=>typeof t=="number"?t*G:t.clone().multiplyScalar(G),c=t=>typeof t=="number"?t/G:t.clone().divideScalar(G),s=(t,u)=>{for(const r of u.objects){t.stroke(r.data.isColliding?"red":"white");const h=t.map(r.position.x,0,u.dimensions.x,0,t.width),f=t.map(r.position.y,0,u.dimensions.y,t.height,0);if(r.geometry.type==="sphere"){const d=i(r.geometry.r*2);t.strokeWeight(d),t.point(h,f)}if(r.geometry.type==="line"){const d=h+t.map(r.geometry.vector.x,0,u.dimensions.x,0,t.width),p=f-t.map(r.geometry.vector.y,0,u.dimensions.y,0,t.height);t.strokeWeight(2),t.line(h,f,d,p)}}};let m;const l=t=>{t.setup=()=>{m=t;const r=i(e.dimensions);t.createCanvas(r.x,r.y),t.background(0),t.fill(255),t.stroke(255),n()},t.draw=()=>{if(t.background(0),t.mouseIsPressed){o.fixed=!0;const r=c(new y(t.mouseX,t.height-t.mouseY));o.position.copy(r)}else o.fixed=!1;e.step(),s(t,e)};let u;t.mousePressed=()=>{u=c(new y(t.mouseX,t.height-t.mouseY))},t.mouseReleased=()=>{const r=c(new y(t.mouseX,t.height-t.mouseY)),h=u.subtract(r);o.position.copy(r),o.velocity.copy(h)}};return A(()=>{m==null||m.remove()}),[l]}class je extends F{constructor(e){super(),M(this,e,xe,_e,X,{})}}function Q(a,e,o){const n=a.slice();return n[1]=e[o],n}function Z(a,e,o){const n=a.slice();return n[1]=e[o],n}function ke(a){let e=a[1].title+"",o;return{c(){o=B(e)},l(n){o=I(n,e)},m(n,i){$(n,o,i)},p:se,d(n){n&&g(o)}}}function ee(a){let e,o;return e=new de({props:{$$slots:{default:[ke]},$$scope:{ctx:a}}}),{c(){j(e.$$.fragment)},l(n){T(e.$$.fragment,n)},m(n,i){k(e,n,i),o=!0},p(n,i){const c={};i&64&&(c.$$scope={dirty:i,ctx:n}),e.$set(c)},i(n){o||(b(e.$$.fragment,n),o=!0)},o(n){v(e.$$.fragment,n),o=!1},d(n){S(e,n)}}}function Se(a){let e,o,n=a[0],i=[];for(let s=0;s<n.length;s+=1)i[s]=ee(Z(a,n,s));const c=s=>v(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=q()},l(s){for(let m=0;m<i.length;m+=1)i[m].l(s);e=q()},m(s,m){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(s,m);$(s,e,m),o=!0},p(s,m){if(m&1){n=s[0];let l;for(l=0;l<n.length;l+=1){const t=Z(s,n,l);i[l]?(i[l].p(t,m),b(i[l],1)):(i[l]=ee(t),i[l].c(),b(i[l],1),i[l].m(e.parentNode,e))}for(U(),l=n.length;l<i.length;l+=1)c(l);J()}},i(s){if(!o){for(let m=0;m<n.length;m+=1)b(i[m]);o=!0}},o(s){i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)v(i[m]);o=!1},d(s){ie(i,s),s&&g(e)}}}function Te(a){let e,o,n;var i=a[1].component;function c(s){return{}}return i&&(e=K(i,c())),{c(){e&&j(e.$$.fragment),o=P()},l(s){e&&T(e.$$.fragment,s),o=D(s)},m(s,m){e&&k(e,s,m),$(s,o,m),n=!0},p(s,m){if(i!==(i=s[1].component)){if(e){U();const l=e;v(l.$$.fragment,1,0,()=>{S(l,1)}),J()}i?(e=K(i,c()),j(e.$$.fragment),b(e.$$.fragment,1),k(e,o.parentNode,o)):e=null}},i(s){n||(e&&b(e.$$.fragment,s),n=!0)},o(s){e&&v(e.$$.fragment,s),n=!1},d(s){e&&S(e,s),s&&g(o)}}}function te(a){let e,o;return e=new ue({props:{$$slots:{default:[Te]},$$scope:{ctx:a}}}),{c(){j(e.$$.fragment)},l(n){T(e.$$.fragment,n)},m(n,i){k(e,n,i),o=!0},p(n,i){const c={};i&64&&(c.$$scope={dirty:i,ctx:n}),e.$set(c)},i(n){o||(b(e.$$.fragment,n),o=!0)},o(n){v(e.$$.fragment,n),o=!1},d(n){S(e,n)}}}function Ce(a){let e,o,n,i;e=new me({props:{$$slots:{default:[Se]},$$scope:{ctx:a}}});let c=a[0],s=[];for(let l=0;l<c.length;l+=1)s[l]=te(Q(a,c,l));const m=l=>v(s[l],1,1,()=>{s[l]=null});return{c(){j(e.$$.fragment),o=P();for(let l=0;l<s.length;l+=1)s[l].c();n=q()},l(l){T(e.$$.fragment,l),o=D(l);for(let t=0;t<s.length;t+=1)s[t].l(l);n=q()},m(l,t){k(e,l,t),$(l,o,t);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(l,t);$(l,n,t),i=!0},p(l,t){const u={};if(t&64&&(u.$$scope={dirty:t,ctx:l}),e.$set(u),t&1){c=l[0];let r;for(r=0;r<c.length;r+=1){const h=Q(l,c,r);s[r]?(s[r].p(h,t),b(s[r],1)):(s[r]=te(h),s[r].c(),b(s[r],1),s[r].m(n.parentNode,n))}for(U(),r=c.length;r<s.length;r+=1)m(r);J()}},i(l){if(!i){b(e.$$.fragment,l);for(let t=0;t<c.length;t+=1)b(s[t]);i=!0}},o(l){v(e.$$.fragment,l),s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)v(s[t]);i=!1},d(l){S(e,l),l&&g(o),ie(s,l),l&&g(n)}}}function Ee(a){let e,o;return e=new fe({props:{$$slots:{default:[Ce]},$$scope:{ctx:a}}}),{c(){j(e.$$.fragment)},l(n){T(e.$$.fragment,n)},m(n,i){k(e,n,i),o=!0},p(n,[i]){const c={};i&64&&(c.$$scope={dirty:i,ctx:n}),e.$set(c)},i(n){o||(b(e.$$.fragment,n),o=!0)},o(n){v(e.$$.fragment,n),o=!1},d(n){S(e,n)}}}function Oe(a){return[[{title:"Test collisions 2",component:je},{title:"Test collisions",component:ve},{title:"Test engine",component:$e}]]}class Be extends F{constructor(e){super(),M(this,e,Oe,Ee,X,{})}}export{Be as default};
