var Q=Object.defineProperty;var Z=(f,e,s)=>e in f?Q(f,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):f[e]=s;var S=(f,e,s)=>(Z(f,typeof e!="symbol"?e+"":e,s),s);import{S as F,i as L,s as M,k as O,w as b,a as C,q as P,l as D,m as W,x as w,h as g,c as E,r as N,n as A,b as h,y as v,D as B,I as R,u as H,f as _,t as x,z as j,J as U,B as ee}from"../../../chunks/index-33d6e1ba.js";import{v as y,P as z,T as te,a as se,b as q,c as V}from"../../../chunks/index-c8ea7b20.js";const oe=(f,e)=>{if(e.geometry.type!=="sphere"||f.geometry.type!=="line")throw new Error("invalid geometry");const s=f.position.clone(),o=f.position.clone().add(f.geometry.vector),c=e.position.clone(),n=e.geometry.r,u=o.clone().subtract(s),r=s.clone().subtract(c),m=u.dot(u),t=r.dot(u)*2,a=r.dot(r)-n*n;let i=t*t-4*m*a;if(i<0)return;i=Math.sqrt(i);const p=(-t-i)/(2*m),l=(-t+i)/(2*m);if(p>=0&&p<=1)return s.add(u.multiplyScalar(p));if(l>=0&&l<=1)return s.add(u.multiplyScalar(l))};class J{constructor(e){S(this,"gravityEnabled");S(this,"dimensions");S(this,"t");S(this,"objects");S(this,"gravity",new y(0,-9.8));S(this,"drag",.01);S(this,"reporter");S(this,"lastTick");this.gravityEnabled=e.enableGravity??!0,this.dimensions=e.dimensions||new y(100,100),this.objects=[],this.t=0,this.reporter=e.reporter||console.log,this.lastTick=0}addObject(e){this.objects.push(e)}applyGravity(e){e.acceleration.push(this.gravity)}applyDynamics(e){const s=Date.now(),o=5,c=(s-this.lastTick)/(1e3/60*o);this.gravityEnabled&&this.applyGravity(e);const n=new y(0,0);for(;e.acceleration.length;){const r=e.acceleration.pop();r&&n.add(r)}n.divideScalar(e.m);const u=1-this.drag;e.velocity.add(n.multiplyScalar(c)).multiplyScalar(u),e.position.add(e.velocity.clone().multiplyScalar(c))}applyCollisions(e){const s=this.objects.find(n=>n.geometry.type==="sphere"),o=this.objects.filter(n=>n.geometry.type==="line");if(!s)throw new Error("No sphere in world");s.data.isColliding=!1;for(const n of o)oe(n,s)&&(s.data.isColliding=!0);const c=.9;e.position.x<0&&e.velocity.x<0&&(e.velocity.x*=-c),e.position.x>this.dimensions.x&&e.velocity.x>0&&(e.velocity.x*=-c),e.position.y<0&&e.velocity.y<0&&(e.velocity.y*=-c),e.position.y>this.dimensions.y&&e.velocity.y>0&&(e.velocity.y*=-c)}step(){this.t===0&&(this.lastTick=Date.now()),this.t++;for(const e of this.objects)e.fixed||this.applyDynamics(e),this.applyCollisions(e);this.reporter&&this.reporter(this),this.lastTick=Date.now()}}const T=f=>{var e,s;return{geometry:f.geometry,m:f.mass??10,position:((e=f.position)==null?void 0:e.clone())??new y(0,0),velocity:((s=f.velocity)==null?void 0:s.clone())??new y(0,0),acceleration:[],fixed:f.fixed??!1,data:{isColliding:!1}}};function ne(f){let e,s,o,c,n=f[0][f[0].length-1]+"",u,r,m,t,a,i,p;return s=new z({props:{sketch:f[2]}}),{c(){e=O("div"),b(s.$$.fragment),o=C(),c=O("p"),u=P(n),r=C(),m=O("button"),t=P("New ball"),this.h()},l(l){e=D(l,"DIV",{class:!0});var $=W(e);w(s.$$.fragment,$),$.forEach(g),o=E(l),c=D(l,"P",{});var d=W(c);u=N(d,n),d.forEach(g),r=E(l),m=D(l,"BUTTON",{});var k=W(m);t=N(k,"New ball"),k.forEach(g),this.h()},h(){A(e,"class","d-flex justify-content-center")},m(l,$){h(l,e,$),v(s,e,null),h(l,o,$),h(l,c,$),B(c,u),h(l,r,$),h(l,m,$),B(m,t),a=!0,i||(p=R(m,"click",f[1]),i=!0)},p(l,[$]){(!a||$&1)&&n!==(n=l[0][l[0].length-1]+"")&&H(u,n)},i(l){a||(_(s.$$.fragment,l),a=!0)},o(l){x(s.$$.fragment,l),a=!1},d(l){l&&g(e),j(s),l&&g(o),l&&g(c),l&&g(r),l&&g(m),i=!1,p()}}}function ie(f,e,s){console.clear();let o=[];const c=t=>{const a=t.objects[t.objects.length-1],i=a.position.clone().toFixed(2),p=a.velocity.clone().toFixed(2);o.push(`${t.t} - pos: ${i} - vel: ${p}`),o.length>50&&o.shift(),s(0,o)},n=new J({reporter:c,enableGravity:!0}),u=()=>{for(;n.objects.length;)n.objects.pop();const t=T({geometry:{type:"line",vector:new y(100,0)},position:new y(0,0),fixed:!0});n.addObject(t);for(let a=0;a<1;a++){const i=T({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)});n.addObject(i)}};let r;const m=t=>{t.setup=()=>{r=t,t.createCanvas(900,600),t.background(0),t.fill(255),t.stroke(255),u()},t.draw=()=>{t.background(0),n.step();for(const a of n.objects){const i=t.map(a.position.x,0,n.dimensions.x,0,t.width),p=t.map(a.position.y,0,n.dimensions.y,t.height,0);if(a.geometry.type==="sphere"&&(t.strokeWeight(a.geometry.r*2),t.point(i,p)),a.geometry.type==="line"){const l=i+t.map(a.geometry.vector.x,0,n.dimensions.x,0,t.width),$=p+t.map(a.geometry.vector.y,0,n.dimensions.y,0,t.height);t.strokeWeight(2),t.line(i,p,l,$)}}}};return U(()=>{r==null||r.remove()}),[o,u,m]}class re extends F{constructor(e){super(),L(this,e,ie,ne,M,{})}}function le(f){let e,s,o,c,n=f[0][f[0].length-1]+"",u,r,m,t,a,i,p;return s=new z({props:{sketch:f[2]}}),{c(){e=O("div"),b(s.$$.fragment),o=C(),c=O("p"),u=P(n),r=C(),m=O("button"),t=P("New ball"),this.h()},l(l){e=D(l,"DIV",{class:!0});var $=W(e);w(s.$$.fragment,$),$.forEach(g),o=E(l),c=D(l,"P",{});var d=W(c);u=N(d,n),d.forEach(g),r=E(l),m=D(l,"BUTTON",{});var k=W(m);t=N(k,"New ball"),k.forEach(g),this.h()},h(){A(e,"class","d-flex justify-content-center")},m(l,$){h(l,e,$),v(s,e,null),h(l,o,$),h(l,c,$),B(c,u),h(l,r,$),h(l,m,$),B(m,t),a=!0,i||(p=R(m,"click",f[1]),i=!0)},p(l,[$]){(!a||$&1)&&n!==(n=l[0][l[0].length-1]+"")&&H(u,n)},i(l){a||(_(s.$$.fragment,l),a=!0)},o(l){x(s.$$.fragment,l),a=!1},d(l){l&&g(e),j(s),l&&g(o),l&&g(c),l&&g(r),l&&g(m),i=!1,p()}}}const G=6;function ce(f,e,s){console.clear();let o=[];const c=i=>{const p=i.objects[i.objects.length-1],l=p.position.clone().toFixed(2),$=p.velocity.clone().toFixed(2);o.push(`${i.t} - pos: ${l} - vel: ${$}`),o.length>50&&o.shift(),s(0,o)},n=new J({reporter:c,enableGravity:!0});let u,r;const m=()=>{for(;n.objects.length;)n.objects.pop();r=T({geometry:{type:"line",vector:new y(80,20)},position:new y(10,20),fixed:!0}),n.addObject(r),u=T({geometry:{type:"sphere",r:10},position:new y(20,50),velocity:new y(2.5,2.5),fixed:!0}),n.addObject(u)};let t;const a=i=>{const p=d=>typeof d=="number"?d*G:d.clone().multiplyScalar(G),l=d=>typeof d=="number"?d/G:d.clone().divideScalar(G);i.setup=()=>{t=i;const d=p(n.dimensions);i.createCanvas(d.x,d.y),i.background(0),i.fill(255),i.stroke(255),m()};let $;i.draw=()=>{if(i.background(0),n.step(),i.mouseIsPressed){const d=l(new y(i.mouseX,i.height-i.mouseY));if($||(d.distance(u.position)<2?$="sphere":d.distance(r.position)<2?$="wallstart":d.distance(r.geometry.vector.clone().add(r.position))<2&&($="wallend")),$==="sphere"&&u.position.copy(d),$==="wallstart"&&r.position.copy(d),$==="wallend"){const k=d.clone().subtract(r.position);r.geometry.vector.copy(k)}}else $=void 0;for(const d of n.objects){i.stroke(u.data.isColliding?"red":"white");const k=i.map(d.position.x,0,n.dimensions.x,0,i.width),X=i.map(d.position.y,0,n.dimensions.y,i.height,0);if(d.geometry.type==="sphere"){const Y=p(d.geometry.r*2);i.strokeWeight(Y),i.point(k,X)}if(d.geometry.type==="line"){const Y=k+i.map(d.geometry.vector.x,0,n.dimensions.x,0,i.width),K=X-i.map(d.geometry.vector.y,0,n.dimensions.y,0,i.height);i.strokeWeight(2),i.line(k,X,Y,K)}}}};return U(()=>{t==null||t.remove()}),[o,m,a]}class ae extends F{constructor(e){super(),L(this,e,ce,le,M,{})}}function fe(f){let e,s,o;return s=new z({props:{sketch:f[0]}}),{c(){e=O("div"),b(s.$$.fragment),this.h()},l(c){e=D(c,"DIV",{class:!0});var n=W(e);w(s.$$.fragment,n),n.forEach(g),this.h()},h(){A(e,"class","d-flex justify-content-center")},m(c,n){h(c,e,n),v(s,e,null),o=!0},p:ee,i(c){o||(_(s.$$.fragment,c),o=!0)},o(c){x(s.$$.fragment,c),o=!1},d(c){c&&g(e),j(s)}}}const I=6;function me(f){console.clear();const e=new J({reporter:()=>{},enableGravity:!0});let s;const o=()=>{for(;e.objects.length;)e.objects.pop();const t=T({geometry:{type:"line",vector:new y(100,0)},position:new y(0,2),fixed:!0});e.addObject(t);const a=T({geometry:{type:"line",vector:new y(100,0)},position:new y(0,98),fixed:!0});e.addObject(a);const i=T({geometry:{type:"line",vector:new y(0,100)},position:new y(2,0),fixed:!0});e.addObject(i);const p=T({geometry:{type:"line",vector:new y(0,100)},position:new y(98,0),fixed:!0});e.addObject(p);const l=T({geometry:{type:"line",vector:new y(50,50)},position:new y(20,10),fixed:!0});e.addObject(l),s=T({geometry:{type:"sphere",r:5},position:new y(20,50),velocity:new y(Math.random()*5-2.5,Math.random()*20)}),e.addObject(s)},c=t=>typeof t=="number"?t*I:t.clone().multiplyScalar(I),n=t=>typeof t=="number"?t/I:t.clone().divideScalar(I),u=(t,a)=>{for(const i of a.objects){t.stroke(i.data.isColliding?"red":"white");const p=t.map(i.position.x,0,a.dimensions.x,0,t.width),l=t.map(i.position.y,0,a.dimensions.y,t.height,0);if(i.geometry.type==="sphere"){const $=c(i.geometry.r*2);t.strokeWeight($),t.point(p,l)}if(i.geometry.type==="line"){const $=p+t.map(i.geometry.vector.x,0,a.dimensions.x,0,t.width),d=l-t.map(i.geometry.vector.y,0,a.dimensions.y,0,t.height);t.strokeWeight(2),t.line(p,l,$,d)}}};let r;const m=t=>{t.setup=()=>{r=t;const i=c(e.dimensions);t.createCanvas(i.x,i.y),t.background(0),t.fill(255),t.stroke(255),o()},t.draw=()=>{if(t.background(0),t.mouseIsPressed){s.fixed=!0;const i=n(new y(t.mouseX,t.height-t.mouseY));s.position.copy(i)}else s.fixed=!1;e.step(),u(t,e)};let a;t.mousePressed=()=>{a=n(new y(t.mouseX,t.height-t.mouseY))},t.mouseReleased=()=>{const i=n(new y(t.mouseX,t.height-t.mouseY)),p=a.subtract(i);s.position.copy(i),s.velocity.copy(p)}};return U(()=>{r==null||r.remove()}),[m]}class $e extends F{constructor(e){super(),L(this,e,me,fe,M,{})}}function ue(f){let e;return{c(){e=P("Test collisions 2")},l(s){e=N(s,"Test collisions 2")},m(s,o){h(s,e,o)},d(s){s&&g(e)}}}function de(f){let e;return{c(){e=P("Test collisions")},l(s){e=N(s,"Test collisions")},m(s,o){h(s,e,o)},d(s){s&&g(e)}}}function pe(f){let e;return{c(){e=P("Test engine")},l(s){e=N(s,"Test engine")},m(s,o){h(s,e,o)},d(s){s&&g(e)}}}function ye(f){let e,s,o,c,n,u;return e=new V({props:{$$slots:{default:[ue]},$$scope:{ctx:f}}}),o=new V({props:{$$slots:{default:[de]},$$scope:{ctx:f}}}),n=new V({props:{$$slots:{default:[pe]},$$scope:{ctx:f}}}),{c(){b(e.$$.fragment),s=C(),b(o.$$.fragment),c=C(),b(n.$$.fragment)},l(r){w(e.$$.fragment,r),s=E(r),w(o.$$.fragment,r),c=E(r),w(n.$$.fragment,r)},m(r,m){v(e,r,m),h(r,s,m),v(o,r,m),h(r,c,m),v(n,r,m),u=!0},p(r,m){const t={};m&1&&(t.$$scope={dirty:m,ctx:r}),e.$set(t);const a={};m&1&&(a.$$scope={dirty:m,ctx:r}),o.$set(a);const i={};m&1&&(i.$$scope={dirty:m,ctx:r}),n.$set(i)},i(r){u||(_(e.$$.fragment,r),_(o.$$.fragment,r),_(n.$$.fragment,r),u=!0)},o(r){x(e.$$.fragment,r),x(o.$$.fragment,r),x(n.$$.fragment,r),u=!1},d(r){j(e,r),r&&g(s),j(o,r),r&&g(c),j(n,r)}}}function ge(f){let e,s;return e=new $e({}),{c(){b(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,c){v(e,o,c),s=!0},i(o){s||(_(e.$$.fragment,o),s=!0)},o(o){x(e.$$.fragment,o),s=!1},d(o){j(e,o)}}}function he(f){let e,s;return e=new ae({}),{c(){b(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,c){v(e,o,c),s=!0},i(o){s||(_(e.$$.fragment,o),s=!0)},o(o){x(e.$$.fragment,o),s=!1},d(o){j(e,o)}}}function be(f){let e,s;return e=new re({}),{c(){b(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,c){v(e,o,c),s=!0},i(o){s||(_(e.$$.fragment,o),s=!0)},o(o){x(e.$$.fragment,o),s=!1},d(o){j(e,o)}}}function we(f){let e,s,o,c,n,u,r,m;return e=new se({props:{$$slots:{default:[ye]},$$scope:{ctx:f}}}),o=new q({props:{$$slots:{default:[ge]},$$scope:{ctx:f}}}),n=new q({props:{$$slots:{default:[he]},$$scope:{ctx:f}}}),r=new q({props:{$$slots:{default:[be]},$$scope:{ctx:f}}}),{c(){b(e.$$.fragment),s=C(),b(o.$$.fragment),c=C(),b(n.$$.fragment),u=C(),b(r.$$.fragment)},l(t){w(e.$$.fragment,t),s=E(t),w(o.$$.fragment,t),c=E(t),w(n.$$.fragment,t),u=E(t),w(r.$$.fragment,t)},m(t,a){v(e,t,a),h(t,s,a),v(o,t,a),h(t,c,a),v(n,t,a),h(t,u,a),v(r,t,a),m=!0},p(t,a){const i={};a&1&&(i.$$scope={dirty:a,ctx:t}),e.$set(i);const p={};a&1&&(p.$$scope={dirty:a,ctx:t}),o.$set(p);const l={};a&1&&(l.$$scope={dirty:a,ctx:t}),n.$set(l);const $={};a&1&&($.$$scope={dirty:a,ctx:t}),r.$set($)},i(t){m||(_(e.$$.fragment,t),_(o.$$.fragment,t),_(n.$$.fragment,t),_(r.$$.fragment,t),m=!0)},o(t){x(e.$$.fragment,t),x(o.$$.fragment,t),x(n.$$.fragment,t),x(r.$$.fragment,t),m=!1},d(t){j(e,t),t&&g(s),j(o,t),t&&g(c),j(n,t),t&&g(u),j(r,t)}}}function ve(f){let e,s;return e=new te({props:{$$slots:{default:[we]},$$scope:{ctx:f}}}),{c(){b(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,c){v(e,o,c),s=!0},p(o,[c]){const n={};c&1&&(n.$$scope={dirty:c,ctx:o}),e.$set(n)},i(o){s||(_(e.$$.fragment,o),s=!0)},o(o){x(e.$$.fragment,o),s=!1},d(o){j(e,o)}}}class ke extends F{constructor(e){super(),L(this,e,null,ve,M,{})}}export{ke as default};
